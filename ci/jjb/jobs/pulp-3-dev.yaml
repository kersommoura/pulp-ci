# This code assumes that Pulp and Pulp Smash are to be installed on localhost.
- job-template:
    name: pulp-3-devel-{os}
    node: '{os}-os'
    description: |
      <p>Install a Pulp 3 development environment on a host, and smash it.</p>
      <p>
        The installation procedure assumes that Pulp and Pulp Smash should be
        installed on localhost. As a result, actions like SSH configuration are
        skipped.
      </p>
    properties:
      - qe-ownership
    wrappers:
      - config-file-provider:
          files:
            - file-id: rhn_credentials
              variable: RHN_CREDENTIALS
      - inject:
          properties-content: |
            OS={os}
    triggers:
        - timed: "H 2 * * *"
    builders:
      - fix-hostname
      - shell:
         !include-raw-escape:
           - configure-rhel7.sh
      # Add Pulp3 installer here
      # Install and run Pulp Smash.
      - shell:
          !include-raw-escape:
              - pulp-3-devel-smasher.sh
    publishers:
        - postbuildscript:
            script-only-if-succeeded: False
            script-only-if-failed: False
            builders:
              - shell: |
                  if [[ "${{OS}}" =~ "rhel" ]]; then
                      sudo subscription-manager unregister
                  fi
        - junit:
            results: 'junit-report.xml'
        - archive:
            artifacts: "*.tar.gz"
            allow-empty: true
        - email-notify-owners
        - delete-slave-node
